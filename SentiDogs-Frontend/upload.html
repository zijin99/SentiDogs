<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>Upload Page and Infor List</title>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <link href="https://unpkg.com/filepond/dist/filepond.css" rel="stylesheet">
    <link href="./css/filepond-plugin-media-preview.css" rel="stylesheet">
    <link href="https://cdn.staticfile.org/twitter-bootstrap/5.1.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.staticfile.org/twitter-bootstrap/5.1.1/js/bootstrap.bundle.min.js"></script>
    <link href="./css/upload.css" rel="stylesheet">
    <script>
        $(function() {
            const place = [];

            $.getJSON('./test.json', function(data) {
                $.each(data, function(i, f) {
                    const tblRow = "<tr>" + "<td>" + f.name + "</td>" +
                        "<td>" + f.sentiment + "</td>" + "<td>" + "<a href=" + f.metadata.wikipedia_url+ ">"
                        + f.name +"</a>" +  "</td>" + "<td>" + "<a href=" + f.metadata.google_maps_url+ ">"+
                        f.name +"</a>" + "</td>" + "</tr>"
                    $(tblRow).appendTo("#userdata tbody");
                });
            });
        });
    </script>
</head>
<body>
<div class="container-fluid mt-3">
    <div class="row">
        <div class="div-left col">
            <div class="demo">
                <input type="file">
                <div>
                    <button class="btn btn-secondary dropdown-toggle dropdownlist" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false"
                            name="dropdown">
                        Type of Content
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuList" id="lists">
                        <li><a class="dropdown-item" id = "travel" onclick="travelhelper()">Travel Destination</a></li>
                        <li><a class="dropdown-item" id = "restaurant" onclick="resthelper()">Restaurant</a></li>
                    </ul>
                </div>
<!--                <p id="element">Type you want to upload:</p>-->
                <progress class="progress-bar-animated progress-bar-id" value="0" max="100" id = "uploader">0%</progress>
                <input type="file" value="upload" class="form-control" id="fileButton" style="border: transparent">


            </div>
            <script
                    src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
            <script
                    src="key.js"></script>
            <script type="module">


                // Initialize Firebase
                firebase.initializeApp(firebaseConfig);


                var uploader = document.getElementById("uploader");
                var fileButton = document.getElementById("fileButton");
                fileButton.addEventListener('change', function (e){
                    // Get file
                    var file = e.target.files[0];
                    //Create a storage ref
                    var type = document.getElementsByName("dropdown")[0];
                    if(type.name === "travel"){
                        var storageRef = firebase.storage().ref('travel/' + file.name);
                    }
                    else {
                        var storageRef = firebase.storage().ref('restaurant/' + file.name);
                    }
                    // Upload file
                    var task = storageRef.put(file);
                    //Update progress bar
                    task.on('state_changed',
                        function progress(snapshot){
                            var percentage = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                            uploader.value = percentage;
                        },
                        function error(err){

                        },
                        function complete(){
                        alert("Success Upload!");
                        }
                    );
                });
            </script>

            <script src="./js/filepond-plugin-media-preview.js"></script>
            <script src="https://unpkg.com/filepond/dist/filepond.js"></script>

            <script src="./js/upload.js"></script>
        </div>
        <div class="div-right col">
            <table class="table table-dark table-striped table-hover table-borderless" id = "userdata">
                <thead>
                <tr>
                    <th>Name</th>
                    <th>Sentiment</th>
                    <th>Wikipedia</th>
                    <th>Google Map</th>
                </tr>
                </thead>
                <tbody>

                </tbody>
            </table>
        </div>
    </div>
</div>

</body>
</html>